<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beranda - BUKITKACA</title>
    <link rel="stylesheet" href="style.css">
    <script src="script.js"></script>
    <style>
#bookCarousel {
            position: relative;
            height: 360px;
            width: 100%;
            margin: 20px auto;
            overflow: hidden;
            border: 1px solid #dddddd; /* Border around the carousel */
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.4));
            cursor: pointer;
        }
        .carousel-inner {
            display: flex;
            transition: transform 1s ease;
        }

        .carousel-inner .item {
            min-width: 100%;
            box-sizing: border-box;
            display: flex;
            justify-content: flex-start; /* Align content to the left */
            align-items: flex-start; /* Align content to the top */
        }

        .bookCarousel-item {
            display: flex;
            flex-direction: row; /* Horizontal layout */
            align-items: flex-start; /* Align items at the start */
            justify-content: flex-start; /* Align items to the left */
            width: 100%;
            padding: 15px;
        }

     
        .bookCarousel-item img {
            flex-shrink: 0; /* Mencegah gambar mengecil */
    width: 250px;
    height: 330px;
    background-color: #222;
    border-radius: 3px 15px 15px 3px;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    margin-right: 20px;
}

.bookCarousel-description {
    font-size: 20px;
    line-height: 1.4;
    color: #ffffff;
    text-align: justify; /* Align text to both left and right */
    flex-grow: 1; /* Make the description take the remaining space */
    overflow: hidden; /* Hide overflowing text */
    text-overflow: ellipsis; /* Add "..." when text overflows */
    white-space: normal; /* Allow wrapping to next line */
    word-wrap: break-word; /* Ensure long words break and wrap */
}

        .bookCarousel-title {
            font-size: 34px;
            font-weight: bold;
            color: rgb(255, 255, 255);
            text-align: left;
            margin-bottom: 15px; /* Reduced space between title and description */
        }

        .carousel-control {
            position: absolute;
            top: 50%;
            z-index: 10;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            font-size: 30px;
            padding: 10px;
            cursor: pointer;
            transform: translateY(-50%);
        }

        .carousel-control.left {
            left: 10px;
        }

        .carousel-control.right {
            right: 10px;
        }

        .carousel-indicators {
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
        }

        .carousel-indicators li {
            display: inline-block;
            margin: 0 5px;
            background-color: rgba(0, 0, 0, 0.5);
            width: 10px;
            height: 10px;
            border-radius: 50%;
            cursor: pointer;
        }

        .carousel-indicators .active {
            background-color: white;
        }

        .carousel-control:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }

        @media (max-width: 768px) {
    #bookCarousel {
            position: relative;
            height: 200px;
            width: 100%;
            margin: 20px auto;
            overflow: hidden;
            border: 1px solid #dddddd; /* Border around the carousel */
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.4));
            cursor: pointer;
        }
.bookCarousel-item img {
    flex-shrink: 0; /* Mencegah gambar mengecil */
    width: 150px;
    height: 180px;
    background-color: #222;
    border-radius: 3px 15px 15px 3px;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    margin-right: 20px;

}

.bookCarousel-item {
            display: flex;
            flex-direction: row; /* Horizontal layout */
            align-items: flex-start; /* Align items at the start */
            justify-content: flex-start; /* Align items to the left */
            width: 100%;
            padding: 10px;
        }

        .bookCarousel-title {
    font-size: 20px; /* Reduced font size for the title */
    font-weight: bold;
    color: rgb(255, 255, 255);
    text-align: left;
    margin-bottom: 10px; /* Reduced space between title and description */
}


}
.book-item {
    display: flex;
    flex-direction: column;
    background-color: #222;
    width: 210px;
    border-radius: 5px 15px 15px 15px;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease;
    cursor: pointer;
}


.book-item {
    display: flex;
    flex-direction: column;
    background-color: #222;
    width: 210px;
    border-radius: 5px 15px 15px 15px;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease;
    cursor: pointer;
}
@media (max-width: 768px) {

    .book-item {
        width: 150px; /* Mengurangi lebar buku di layar kecil */
    }
    .book-cover img {
    width: 150px;
    height: 180px;
    object-fit: cover;
    display: block;
}
}
    @media (max-width: 480px) {

    .book-item {
        width: 120px; /* Lebar buku lebih kecil di ponsel */
    }
    .book-cover {
        width: 120px;
        height: 140px; /* Menyesuaikan ukuran cover buku */
    }

    .book-cover img {
    width: 120px;
    height: 140px;
    object-fit: cover;
    display: block;
}
}
    </style>
</head>
<body>
    <header>
        <div class="menu-toggle" onclick="toggleMenu()">â˜°</div>
        <div class="logo">BUKITKACA</div>
        <nav id="navMenu">
            <a href="index.html" class="active">Beranda</a>
            <a href="pojokbaca.html">Pojok Baca</a>
            <a href="pusatinformasi.html">Pusat Informasi</a>
            <a href="upload.html">Upload</a>
            <a href="rakbuku.html">Rak Buku</a>
            <a href="bookmarks.html">Bookmarks</a>
            <a href="#" id="auth-link" class="active" onclick="toggleAuthButton()">Login</a>
        </nav>
        <div class="header-profile-pic" id="headerProfilePic" onclick="window.location.href='profile.html'"></div>
    </header>

    <section class="pageS">BUKU KITA KALIAN BACA</section>
    <section class="content-section">
        <main>
            <div id="bookCarousel" class="carousel">
                <ol class="carousel-indicators" id="carouselIndicators"></ol>
                <div class="carousel-inner" id="carouselContent"></div>
                <button class="carousel-control left" id="prevBtn">&#10094;</button>
                <button class="carousel-control right" id="nextBtn">&#10095;</button>
            </div>

            <h2>Update Terbaru</h2>
            <div id="bookList" class="book-list"></div>
        </main>
    </section>

    <footer>
        <p>&copy; 2024 BUKITKACA. Semua Hak Dilindungi.</p>
        <a href="mailto:arifalfiancanls@gmail.com">kontak@bukitkaca.com</a>.</p>
    </footer>
    

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getDatabase, ref as dbRef, get } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA2VBOHY24RLpCL9WnEkQp3FE9ydpAdrgk",
            authDomain: "bukitkaca-65e92.firebaseapp.com",
            databaseURL: "https://bukitkaca-65e92-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "bukitkaca-65e92",
            storageBucket: "bukitkaca-65e92.firebasestorage.app",
            messagingSenderId: "848017575081",
            appId: "1:848017575081:web:756445e54749aa261cadb8",
            measurementId: "G-YLP8GC5T3J"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);


      // Populate the carousel with books from Firebase
      async function populateCarousel() {
            const carouselContent = document.getElementById('carouselContent');
            const carouselIndicators = document.getElementById('carouselIndicators');

            carouselContent.innerHTML = '';
            carouselIndicators.innerHTML = '';

            const bookDataRef = dbRef(database, 'books/');
            const snapshot = await get(bookDataRef);

            if (snapshot.exists()) {
                const books = snapshot.val();

                // Ambil semua key-value dari buku
                const bookArray = Object.entries(books).slice(0, 7); // Ambil maksimal 7 buku untuk carousel

                bookArray.forEach(([bookKey, book], index) => {
                    const item = document.createElement('div');
                    item.classList.add('item', 'bookCarousel-item');
                    if (index === 0) item.classList.add('active');

                    item.innerHTML = `
                        <img src="${book.coverBase64}" alt="Cover Buku">
                        <div>
                            <div class="bookCarousel-title">${book.title}</div>
                            <div class="bookCarousel-description">${book.description}</div>
                        </div>
                    `;
                arouselIndicators.appendChild(indicator);
                });

                moveToSlide(0);
            } else {
                carouselContent.innerHTML = '<p>Tidak ada buku yang di-upload.</p>';
            }
        }


  // Fungsi untuk berpindah slide
  let currentIndex = 0;
        function moveToSlide(index) {
            const items = document.querySelectorAll('.carousel-inner .item');
            if (index >= items.length) currentIndex = 0;
            else if (index < 0) currentIndex = items.length - 1;
            else currentIndex = index;

            const newTransformValue = -currentIndex * 100;
            document.querySelector('.carousel-inner').style.transform = `translateX(${newTransformValue}%)`;

            // Update indikator aktif
            document.querySelectorAll('.carousel-indicators li').forEach((indicator, i) => {
                if (i === currentIndex) indicator.classList.add('active');
                else indicator.classList.remove('active');
            });
        }

        // Kontrol tombol
        document.getElementById('nextBtn').addEventListener('click', function() {
            moveToSlide(currentIndex + 1);
            resetAutoScroll();
        });

        document.getElementById('prevBtn').addEventListener('click', function() {
            moveToSlide(currentIndex - 1);
            resetAutoScroll();
        });

        // Fungsi untuk otomatis menggulir slide setiap 5 detik
        let autoScroll;
        function startAutoScroll() {
            autoScroll = setInterval(() => {
                moveToSlide(currentIndex + 1);
            }, 7000); // 5000ms = 5 detik
        }

        // Reset auto-scroll saat pengguna mengontrol carousel secara manual
        function resetAutoScroll() {
            clearInterval(autoScroll);
            startAutoScroll();
        }

        // Fungsi untuk memuat daftar buku tanpa login
        async function loadBookList() {
    const bookListContainer = document.getElementById('bookList');
    bookListContainer.innerHTML = ''; // Clear the book list container

    const loadingMessage = document.createElement('p');
    loadingMessage.textContent = 'Memuat Buku...';
    bookListContainer.appendChild(loadingMessage);

    const bookDataRef = dbRef(database, 'books/');
    const snapshot = await get(bookDataRef);

    if (snapshot.exists()) {
        const books = snapshot.val();
        bookListContainer.innerHTML = ''; // Clear any previous content
        let foundBooks = false;

        // Convert the books object to an array of [key, book] pairs
        const bookArray = Object.entries(books);

        // Sort the books by 'updatedAt' in descending order
        bookArray.sort((a, b) => new Date(b[1].updatedAt) - new Date(a[1].updatedAt));

        // Display the sorted books
        for (const [key, book] of bookArray) {
            const bookItem = document.createElement('div');
            bookItem.className = 'book-item';
            bookItem.innerHTML = `
                <div class="book-cover">
                    <img src="${book.coverBase64}" alt="Cover Buku">
                </div>
                <div class="book-details">
                    <strong>${book.title}</strong><br>
                    Genre: ${book.genre.join(', ')}<br>
                    Pengupload: ${book.uploadedBy}<br>
                    <em>${timeAgo(book.updatedAt)}</em><br>
                </div>
            `;
            bookItem.addEventListener('click', function() {
                window.location.href = `lihatbuku.html?bookKey=${key}`;
            });

            bookListContainer.appendChild(bookItem);
            foundBooks = true;
        }

        if (!foundBooks) {
            bookListContainer.innerHTML = '<p>Tidak ada buku yang di-upload.</p>';
        }
    } else {
        bookListContainer.innerHTML = '<p>Tidak ada buku yang di-upload.</p>';
    }
}

        // Fungsi untuk menghitung waktu yang lalu
        function timeAgo(date) {
            const now = new Date();
            const diff = now - new Date(date); // Selisih dalam milidetik

            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            const weeks = Math.floor(days / 7);
            const months = Math.floor(days / 30);
            const years = Math.floor(days / 365);

            if (seconds < 60) {
                return `${seconds} detik yang lalu`;
            } else if (minutes < 60) {
                return `${minutes} menit yang lalu`;
            } else if (hours < 24) {
                return `${hours} jam yang lalu`;
            } else if (days < 7) {
                return `${days} hari yang lalu`;
            } else if (weeks < 4) {
                return `${weeks} minggu yang lalu`;
            } else if (months < 12) {
                return `${months} bulan yang lalu`;
            } else {
                return `${years} tahun yang lalu`;
            }
        }
        // Memuat buku saat halaman dimuat
        document.addEventListener('DOMContentLoaded', loadHeaderProfilePic);
        window.onload = toggleAuthButton;
        document.addEventListener('DOMContentLoaded', loadBookList);
        document.addEventListener('DOMContentLoaded', populateCarousel);
        document.addEventListener('DOMContentLoaded', startAutoScroll);
    </script>
</body>
</html>
